# Residualé¢œè‰²ä¿ç•™åŠŸèƒ½è¯´æ˜

## ğŸ¨ åŠŸèƒ½æ¦‚è¿°

æ ¹æ®æ‚¨çš„éœ€æ±‚ï¼Œæˆ‘å·²ç»ä¿®æ”¹äº†3D Gaussianç‚¹äº‘é…å‡†ç³»ç»Ÿï¼Œç°åœ¨residualæ–‡ä»¶é»˜è®¤**ä¿ç•™åŸå§‹é¢œè‰²å±æ€§**ï¼Œè€Œä¸æ˜¯å¼ºåˆ¶å˜æˆçº¢è‰²ã€‚

## âœ… ä¸»è¦ä¿®æ”¹

### 1. æ–°å¢é¢œè‰²ä¿ç•™å‚æ•°
- åœ¨`save_residual_gaussians()`å‡½æ•°ä¸­æ·»åŠ äº†`preserve_color`å‚æ•°
- é»˜è®¤å€¼ä¸º`True`ï¼Œä¿ç•™åŸå§‹é¢œè‰²å±æ€§
- å½“è®¾ç½®ä¸º`False`æ—¶ï¼Œæ‰ä¼šå°†residualç‚¹æ ‡è®°ä¸ºçº¢è‰²

### 2. å‘½ä»¤è¡Œé€‰é¡¹
- æ–°å¢`--mark_residual_red`å‚æ•°
- **é»˜è®¤è¡Œä¸º**ï¼šä¿ç•™åŸå§‹é¢œè‰²
- **ä½¿ç”¨æ­¤å‚æ•°**ï¼šå°†residualç‚¹æ ‡è®°ä¸ºçº¢è‰²

### 3. å‡½æ•°ç­¾åæ›´æ–°
```python
def save_residual_gaussians(gaussian_data, residual_indices, output_path, 
                           transformation=None, preserve_color=True):
```

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### ä¿ç•™åŸå§‹é¢œè‰²ï¼ˆé»˜è®¤ï¼‰
```bash
# è¿™äº›å‘½ä»¤éƒ½ä¼šä¿ç•™residualçš„åŸå§‹é¢œè‰²
python3 point_cloud_registration.py --input_dir data_ff/spring --output_dir output_preserve

python3 point_cloud_registration.py --input_dir data_ff/spring --output_dir output_max_common --correspondence_threshold 0.06 --ratio_test 0.8
```

### çº¢è‰²æ ‡è®°ï¼ˆå¯é€‰ï¼‰
```bash
# ä½¿ç”¨--mark_residual_redå‚æ•°å°†residualæ ‡è®°ä¸ºçº¢è‰²
python3 point_cloud_registration.py --input_dir data_ff/spring --output_dir output_red --mark_residual_red
```

## ğŸ“Š éªŒè¯ç»“æœ

é€šè¿‡æµ‹è¯•éªŒè¯ï¼Œä¿®æ”¹åçš„åŠŸèƒ½ï¼š

| æ¨¡å¼ | f_dc_0èŒƒå›´ | f_dc_1èŒƒå›´ | f_dc_2èŒƒå›´ | è¯´æ˜ |
|------|----------|----------|----------|------|
| åŸå§‹æ–‡ä»¶ | [-2.195, 2.356] | [-1.750, 2.936] | [-1.600, 2.636] | åŸå§‹02.ply |
| ä¿ç•™é¢œè‰² | [-2.195, 2.356] | [-1.750, 2.936] | [-1.600, 2.636] | âœ… ä¿ç•™åŸå§‹å±æ€§ |
| çº¢è‰²æ ‡è®° | [1.772, 1.772] | [-1.772, -1.772] | [-1.772, -1.772] | ğŸ”´ å¼ºåˆ¶ä¸ºçº¢è‰² |

## ğŸ¯ æŠ€æœ¯ç»†èŠ‚

### é¢œè‰²ä¿ç•™å®ç°
```python
# ä¿ç•™åŸå§‹é¢œè‰²å±æ€§ï¼ˆé»˜è®¤ï¼‰
if not preserve_color and residual_data['features_dc'].shape[2] > 0:
    # åªæœ‰å½“preserve_color=Falseæ—¶æ‰æ”¹ä¸ºçº¢è‰²
    C0 = 0.28209479177387814
    red_sh = (np.array([1.0, 0.0, 0.0]) - 0.5) / C0
    residual_data['features_dc'][:, :, 0] = red_sh.reshape(1, 3)
    print("Applied red color to residual points")
else:
    print("Preserved original color attributes for residual points")
```

### å‘åå…¼å®¹æ€§
- æ‰€æœ‰ç°æœ‰ä»£ç æ— éœ€ä¿®æ”¹
- é»˜è®¤è¡Œä¸ºæ”¹ä¸ºä¿ç•™åŸå§‹é¢œè‰²
- ä¿æŒæ‰€æœ‰3D Gaussianå±æ€§å®Œæ•´

## ğŸ“ è¾“å‡ºæ–‡ä»¶è¯´æ˜

é…å‡†åä¼šç”Ÿæˆä»¥ä¸‹æ–‡ä»¶ï¼š

```
output_directory/
â”œâ”€â”€ *_matched.ply      # åŒ¹é…çš„ä¸»è¦éƒ¨åˆ†ï¼ˆç›¸åŒç‚¹æ•°ï¼‰
â”œâ”€â”€ *_residual.ply     # æ–°å‡ºç°éƒ¨åˆ†ï¼ˆä¿ç•™åŸå§‹é¢œè‰²ï¼‰
â”œâ”€â”€ correspondences_*.csv  # å¯¹åº”å…³ç³»æ˜ å°„
â””â”€â”€ transformation_*.txt   # é…å‡†å˜æ¢çŸ©é˜µ
```

## ğŸ” ä¸»è¦ä¼˜åŠ¿

1. **ä¿ç•™åŸå§‹å¤–è§‚**ï¼šresidualæ–‡ä»¶ä¿æŒåŸå§‹é¢œè‰²ï¼Œé€‚åˆç›´æ¥ä½¿ç”¨
2. **å®Œå…¨å…¼å®¹**ï¼šä¸GaussianModel.load_ply()å®Œå…¨å…¼å®¹
3. **çµæ´»æ§åˆ¶**ï¼šå¯é€‰æ‹©æ€§åœ°å¯ç”¨çº¢è‰²æ ‡è®°ç”¨äºè°ƒè¯•
4. **å‘åå…¼å®¹**ï¼šä¸å½±å“ç°æœ‰å·¥ä½œæµç¨‹

## ğŸ’¡ ä½¿ç”¨å»ºè®®

- **æ—¥å¸¸ä½¿ç”¨**ï¼šä½¿ç”¨é»˜è®¤è®¾ç½®ï¼Œä¿ç•™åŸå§‹é¢œè‰²
- **è°ƒè¯•æ¨¡å¼**ï¼šä½¿ç”¨`--mark_residual_red`æ–¹ä¾¿è¯†åˆ«æ–°å¢éƒ¨åˆ†
- **æ‰¹é‡å¤„ç†**ï¼šresidualæ–‡ä»¶å¯ç›´æ¥ç”¨äºåç»­å¤„ç†ï¼Œæ— éœ€é¢œè‰²è½¬æ¢

ç°åœ¨æ‚¨çš„residualæ–‡ä»¶å°†å®Œç¾ä¿ç•™åŸå§‹çš„3D Gaussiané¢œè‰²å±æ€§ï¼ğŸ‰
